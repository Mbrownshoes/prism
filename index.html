<!DOCTYPE html>
<meta charset="utf-8">
<style>
@import url(//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css);

#map {
  width: 960px;
  height: 500px;
  background: none;
}
svg {
  position: relative;
}

.border {
    fill:#ddd;
    stroke: black;
}
</style>

<body>
<p id="map">

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css' rel='stylesheet' />


<script>

var map = L.map('map').setView([49.1642, -123.9364], 4);
        mapLink = 
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
            }).addTo(map);

// var map = L.map('map').setView([47.8, -96], 4);

// L.tileLayer('https://{s}.tiles.mapbox.com/v3/examples.map-zr0njcqy/{z}/{x}/{y}.png', {
//     id: 'examples.map-20v6611k'
// }).addTo(map);


var nexrad = L.tileLayer.wms("http://tools.pacificclimate.org/ncWMS-PCIC/wms", {
    layers: 'pr_monClim_PRISM_historical_run1_197101-200012/pr',
    format: 'image/png',
    transparent: true});
nexrad.addTo(map);

var svg = d3.select(map.getPanes().overlayPane).append("svg"),
    g = svg.append("g").attr("class", "leaflet-zoom-hide");


d3.json("us-states.json", function(collection) {
  var transform = d3.geo.transform({point: projectPoint}),
      path = d3.geo.path().projection(transform);

  var feature = g.selectAll("path")
      .data(collection.features)
    .enter().append("path");

  map.on("viewreset", reset);
  reset();

  // Reposition the SVG to cover the features.
  function reset() {
    var bounds = path.bounds(collection),
        topLeft = bounds[0],
        bottomRight = bounds[1];

    svg .attr("width", bottomRight[0] - topLeft[0])
        .attr("height", bottomRight[1] - topLeft[1])
        .style("left", topLeft[0] + "px")
        .style("top", topLeft[1] + "px");

    g   .attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

    feature.attr("d", path);
  }

  // Use Leaflet to implement a D3 geometric transformation.
  function projectPoint(x, y) {
    var point = map.latLngToLayerPoint(new L.LatLng(y, x));
    this.stream.point(point.x, point.y);
  }
});


function getBC3005Bounds() {
    return new OpenLayers.Bounds(-236114, 41654.75, 2204236, 1947346.25);
}


// function getProjection(a) {
//     return new OpenLayers.Projection("EPSG:" + a);
// }

// function BC3005_map_options() {
//     bounds = getBC3005Bounds();
//     var a = {
//         restrictedExtent: bounds,
//         displayProjection: getProjection(4326),
//         projection: getProjection(3005),
//         units: 'Meter'
//     };
//     return a;
// }

// function getBC3005OsmBaseLayer(a, b, c) {
//     return new OpenLayers.Layer.WMS(b, a, {
//         layers: c
//     }, {
//         projection: getProjection(3005),
//         units: 'Meter',
//         maxExtent: new OpenLayers.Bounds(-1000000, -1000000, 3000000, 3000000),
//         maxResolution: 7812.5,
//         numZoomLevels: 12,
//     });
// }

// options = BC3005_map_options();
// var tcUrls = new Array();
//       tcUrls.push('http://a.tiles.pacificclimate.org/tilecache/tilecache.py');
//       tcUrls.push('http://b.tiles.pacificclimate.org/tilecache/tilecache.py');
//       tcUrls.push('http://c.tiles.pacificclimate.org/tilecache/tilecache.py');
// var ncwmsUrls = new Array();
//       ncwmsUrls.push('http://tools.pacificclimate.org/ncWMS-PCIC/wms');

// var pdp = {
//         VERSION: '0.1',
//         app_root: 'http://tools.pacificclimate.org/dataportal',
//         gs_url: 'http://tools.pacificclimate.org/geoserver/',
//         ncwms_url: ncwmsUrls,
//         tilecache_url: tcUrls,
//         ensemble_name: 'bc_prism'
//       };

// // var map = new OpenLayers.Map('map', options);

// var map = new OpenLayers.Map('map', {projection: 'EPSG:900913'});

// var wms = new OpenLayers.Layer.WMS( "OpenLayers WMS",
//               "http://vmap0.tiles.osgeo.org/wms/vmap0", {layers:'basic'} );
// map.addLayer(wms);

// var baselayer = getBC3005OsmBaseLayer(pdp.tilecache_url, 'BC OpenStreeMap', 'bc_osm');

// // map.addLayer(baselayer);
// // baselayer.setVisibility(false);




// var getNCWMSLayerCapabilities = function(a) {
//     var b = {
//         REQUEST: "GetCapabilities",
//         SERVICE: "WMS",
//         VERSION: "1.1.1",
//         DATASET: a.params.LAYERS.split("/")[0]
//     };
//     $.ajax({
//         url: a.url,
//         data: b
//     }).fail(handle_ie8_xml).always(function(a, b, c) {
//         window.ncwmsCapabilities = $(c.responseXML);
//     });
// };

// defaults = {
//         dataset: "pr_monClim_PRISM_historical_run1_197101-200012",
//         variable: "pr"
//     };

// params = {
//         layers: defaults.dataset + "/" + defaults.variable,
//         transparent: 'true',
//         time: '1985-06-30',
//         styles: 'boxfill/occam_inv',
//         logscale: true,
//         numcolorbands: 254,
//         version: '1.1.1',
//         srs: 'EPSG:3005'
//     };



//     datalayerName = "Climate raster";
//     layer = new OpenLayers.Layer.WMS(datalayerName, pdp.ncwms_url, params, {
//         maxExtent: getBC3005Bounds(),
//         buffer: 1,
//         ratio: 1.5,
//         opacity: 0.7,
//         transitionEffect: null,
//         tileSize: new OpenLayers.Size(512, 512)
//     });
// // map.addLayer(layer);

// map.setCenter(new OpenLayers.LonLat(-100.9, 55.8).transform("EPSG:4326", "EPSG:900913"), 4);

// OpenLayers.Control.ListenToClick = OpenLayers.Class(OpenLayers.Control, {
//   defaultHandlerOptions: {
//     'single': true,
//     'pixelTolerance': 0,
//     'stopSingle': false
//   },

//   initialize: function(options) {
//     this.handlerOptions = OpenLayers.Util.extend(
//       {}, this.defaultHandlerOptions
//       );
//     OpenLayers.Control.prototype.initialize.apply(
//       this, arguments
//       ); 
//     this.handler = new OpenLayers.Handler.Click(
//       this, {
//         'click': this.onClick,
//       }, this.handlerOptions
//       );
//   }, 



//   onClick: function (e) {
    
//     var url =  layer.getFullRequestString({
//       REQUEST: "GetFeatureInfo",
//       EXCEPTIONS: "application/vnd.ogc.se_xml",
//       BBOX: layer.map.getExtent().toBBOX(),
//       X: e.xy.x,
//       Y: e.xy.y,
//       INFO_FORMAT: 'text/xml',
//       QUERY_LAYERS: layer.params.LAYERS,
//       WIDTH: layer.map.size.w,
//       FEATURE_COUNT: 10,
//       HEIGHT: layer.map.size.h});

// console.log(url)
//     if (url) {
//       document.getElementById('info').innerHTML =
//       '<iframe seamless src="' + url + '" scrolling="no" align="middle"  frameBorder="0" height=150%></iframe>';
//     }
//     // url.activate();
//   },



// });
// var ctmControl = new OpenLayers.Control.ListenToClick({
//   handlerOptions: {
//     'single': true,
//     'pixelTolerance': 0,
//     'stopSingle': false
//   }
// });
// map.addControl(ctmControl);
// ctmControl.activate();





</script>
</body>
</html>